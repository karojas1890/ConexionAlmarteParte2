{% extends "layout.html" %}

{% block title %}Pago{% endblock %}

{% block content %}
    <main class="main-content">  
        <div class="progress-section">
            <div class="progress-title">Agendar cita</div>
            <div class="progress-steps">
                <div class="step completed">1</div>
                <div class="step-arrow">‚Üí</div>
                <div class="step completed">2</div>
                <div class="step-arrow">‚Üí</div>
                <div class="step active">3</div>
            </div>
        </div>

        <div class="main">
            <button class="back-button" onclick="window.history.back()">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M10 12L6 8L10 4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Volver
            </button>
            <div class="section-title">Resumen de tu cita</div>

            <div class="summary-card">
                <div class="summary-header" id="service-summary-text"></div>
                <div class="summary-row">
                    <span class="summary-label">Fecha</span>
                    <span class="summary-value" id="summary-date">No seleccionada</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Hora</span>
                    <span class="summary-value" id="summary-time">No seleccionada</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Total</span>
                    <span class="summary-value" id="summary-price">‚Ç°0</span>
                </div>
                <div class="summary-row" id="usd-equivalent" style="display: none;">
                    <span class="summary-label">Equivalente USD</span>
                    <span class="summary-value" id="summary-usd">$0.00</span>
                </div>
            </div>

            <div class="payment-section">
                <div class="payment-title">M√©todo de pago</div>
                
                <div class="payment-option selected" onclick="selectPayment(this)">
                    <div class="payment-icon">üí≥</div>
                    <div class="payment-text">Tarjeta de cr√©dito o d√©bito</div>
                </div>

                <div class="payment-option" onclick="selectPayment(this)">
                    <div class="payment-icon">üè¶</div>
                    <div class="payment-text">Transferencia bancaria</div>
                </div>

                <div class="payment-option" id="almarte-sinpe-option" onclick="selectPaymentAndOpenSINPE(this)">
                    <div class="payment-icon">üì±</div>
                    <div class="payment-text">SINPE m√≥vil</div>
                </div>

                <!-- Seccion de PayPal -->
                <div class="almarte-paypal-section">
                    <div class="almarte-paypal-title">Pagar con PayPal</div>
                    
                    <div class="almarte-paypal-button-container">
                        <div id="almarte-paypal-button-container"></div>
                    </div>

                    <div class="almarte-paypal-info">
                        <div class="almarte-paypal-info-title"></div>
                        <p class="almarte-paypal-info-text"></p>
                        <p class="almarte-paypal-info-text" id="paypal-exchange-rate"></p>
                    </div>
                </div>

                <div class="payment-option" onclick="selectPayment(this)">
                    <div class="payment-icon">üíµ</div>
                    <div class="payment-text">Efectivo el d√≠a de la cita</div>
                </div>
            </div>

            <button class="continue-btn" 
                data-url="{{ url_for('routes.payment') }}" 
                onclick="continueToPaymentForm(this)">
                 Continuar
            </button>
        </div>
        <!--Modal de sinpe Movil-->
         <div class="almarte-sinpe-modal" id="almarte-sinpe-modal">
            <div class="almarte-sinpe-modal-content">
                <div class="almarte-sinpe-header">
                    <div class="almarte-sinpe-icon">üì±</div>
                    <div class="almarte-sinpe-title">Validar SINPE</div>
                </div>

                <div class="almarte-sinpe-info">
                    Ingresa los datos del SINPE que realizaste para validar el pago
                </div>

                <form id="almarte-sinpe-form" onsubmit="almarte_validateSINPE(event)">
                    <div class="almarte-sinpe-form-group">
                        <label class="almarte-sinpe-label" for="almarte-sinpe-reference">N√∫mero de Referencia</label>
                        <input 
                            type="text" 
                            id="almarte-sinpe-reference" 
                            class="almarte-sinpe-input" 
                            placeholder="Ej: 123456789"
                            maxlength="20"
                            required
                        >
                        <div class="almarte-sinpe-error-msg" id="almarte-sinpe-reference-error"></div>
                    </div>

                    <div class="almarte-sinpe-form-group">
                        <label class="almarte-sinpe-label" for="almarte-sinpe-phone">N√∫mero de Tel√©fono</label>
                        <input 
                            type="tel" 
                            id="almarte-sinpe-phone" 
                            class="almarte-sinpe-input" 
                            placeholder="Ej: 87654321"
                            maxlength="15"
                            required
                        >
                        <div class="almarte-sinpe-error-msg" id="almarte-sinpe-phone-error"></div>
                    </div>

                    <div class="almarte-sinpe-form-group">
                        <label class="almarte-sinpe-label" for="almarte-sinpe-amount">Monto (‚Ç°)</label>
                        <input 
                            type="number" 
                            id="almarte-sinpe-amount" 
                            class="almarte-sinpe-input" 
                            placeholder="Ej: 35000"
                            min="0"
                            required
                        >
                        <div class="almarte-sinpe-error-msg" id="almarte-sinpe-amount-error"></div>
                    </div>

                    <div class="almarte-sinpe-buttons">
                        <button 
                            type="button" 
                            class="almarte-sinpe-btn almarte-sinpe-btn-cancel"
                            onclick="almarte_closeSINPEModal()"
                        >
                            Cancelar
                        </button>
                        <button 
                            type="submit" 
                            class="almarte-sinpe-btn almarte-sinpe-btn-submit"
                            id="almarte-sinpe-submit-btn"
                        >
                            Validar SINPE
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </main>
   <script>
    const dashboardUrl = "{{ url_for('routes.dashboard_Consultante') }}";
    const paymentforUrl = "{{ url_for('routes.payment') }}";
    const CITA_URL ="{{ url_for('Citas.CrearCita') }}";
    const usuario = "{{ session.get('idusuario') }}";
    const TC_URL="{{ url_for('tpc.ConsultarTipoCambio') }}";
    const SINPE_URL="{{ url_for('card.VerificarSinpe') }}";
</script>
   </script>
    <!-- PayPal SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AZfjbKTM0Mrs69k-q1LtCyqsd36OFn8temhI756Rw5tW6QecVtrGHN5NBABwIGyvrQyu-wiYyoQiG2M3&currency=USD"></script>
    
    <script src="{{ url_for('static', filename='js/payment-summary.js') }}"></script>
    
 
{% endblock %}